{% extends "base.html" %}

{% block content %}
<h2>Workstation Overview</h2>
<p class="page-intro">Track which workstations currently have jobs waiting and jump directly into each queue.</p>

<form method="get" class="orders-filter">
    <label for="queue-customer" class="sr-only">Filter by customer</label>
    <input
        id="queue-customer"
        type="search"
        name="customer"
        placeholder="Filter by customer"
        value="{{ customer_filter }}"
    >
    <button type="submit">Apply</button>
    {% if customer_filter %}
    <a class="action-btn subtle-action" href="{{ url_for('work.station_overview') }}">Clear</a>
    {% endif %}
</form>

{% if total_waiting %}
<p>{{ total_waiting }} job{{ 's' if total_waiting != 1 else '' }} waiting across all workstations.</p>
{% else %}
<p>No jobs are waiting for any workstation.</p>
{% endif %}

<table class="data-table">
    <thead>
        <tr>
            <th scope="col">Workstation</th>
            <th scope="col">Jobs Waiting</th>
            <th scope="col">Next Order</th>
            <th scope="col">Next Promised Date</th>
        </tr>
    </thead>
    <tbody>
        {% if stations %}
            {% for station in stations %}
            <tr>
                <th scope="row">
                    <a href="{{ url_for('work.station_detail', station_slug=station.slug, customer=customer_filter if customer_filter else None) }}">{{ station.name }}</a>
                </th>
                <td>{{ station.waiting_count }}</td>
                <td>
                    {% if station.next_order %}
                        {% set first_entry = station.entries[0] %}
                        {% if can_access_page('orders') %}
                        <a href="{{ url_for('orders.view_order', order_id=first_entry['order_id']) }}">
                            {{ station.next_order }}
                        </a>
                        {% else %}
                        {{ station.next_order }}
                        {% endif %}
                    {% else %}
                        —
                    {% endif %}
                </td>
                <td>{{ station.next_promised_date or '—' }}</td>
            </tr>
            {% endfor %}
        {% else %}
        <tr>
            <td colspan="4">All workstations are caught up.</td>
        </tr>
        {% endif %}
    </tbody>
</table>

<p>
    <a class="nav-btn" href="{{ url_for('work.list_instructions') }}">Manage Work Instructions</a>
</p>
{% endblock %}
