{% extends "base.html" %}

{% block content %}
<h2>{{ station.name }} Queue</h2>
<p class="page-intro">Jobs that are ready for this workstation to process.</p>

{% set is_framing = station.name|default('', true)|lower == 'framing' %}

<form method="get" class="orders-filter">
    <label for="queue-detail-customer" class="sr-only">Filter by customer</label>
    <input
        id="queue-detail-customer"
        type="search"
        name="customer"
        placeholder="Filter by customer"
        value="{{ customer_filter }}"
    >
    <button type="submit">Apply</button>
    {% if customer_filter %}
    <a class="action-btn subtle-action" href="{{ url_for('work.station_detail', station_slug=station.slug) }}">Clear</a>
    {% endif %}
</form>

{% if station.entries %}
<table class="data-table">
    <thead>
        <tr>
            <th scope="col">Order</th>
            <th scope="col">Customer</th>
            <th scope="col">Item</th>
            <th scope="col">Quantity</th>
            {% if is_framing %}
            <th scope="col">Panels Needed</th>
            <th scope="col">Panel Material</th>
            <th scope="col">Panel Length</th>
            {% endif %}
            <th scope="col">Step</th>
            <th scope="col">Promised</th>
            <th scope="col">Scheduled Completion</th>
            <th scope="col">Status</th>
        </tr>
    </thead>
    <tbody>
        {% for entry in station.entries %}
        <tr>
            <th scope="row">
                {% if can_access_page('orders') %}
                <a href="{{ url_for('orders.view_order', order_id=entry['order_id']) }}">
                    {{ entry['order_number'] }}
                </a>
                {% else %}
                {{ entry['order_number'] }}
                {% endif %}
            </th>
            <td>{{ entry['customer_name'] or '—' }}</td>
            <td>
                {% if entry['item_sku'] %}
                <span class="badge">{{ entry['item_sku'] }}</span>
                {{ entry['item_name'] or '' }}
                {% else %}
                —
                {% endif %}
            </td>
            <td>{{ entry['quantity'] or '—' }}</td>
            {% if is_framing %}
            <td>{{ entry['panels_needed'] if entry['panels_needed'] is not none else '—' }}</td>
            <td>{{ entry['panel_material'] or '—' }}</td>
            <td>
                {% if entry['panel_length'] is not none %}
                {{ '%.2f' % entry['panel_length'] }}
                {% else %}
                —
                {% endif %}
            </td>
            {% endif %}
            <td>
                <strong>Step {{ entry['sequence'] }}</strong><br>
                {{ entry['description'] }}
            </td>
            <td>{{ entry['promised_date'] or '—' }}</td>
            <td>{{ entry['scheduled_completion'] or '—' }}</td>
            <td>{{ entry['order_status'] }}</td>
        </tr>
        {% endfor %}
    </tbody>
</table>
{% else %}
<p>No jobs are currently waiting on this workstation.</p>
{% endif %}

<p>
    <a class="nav-btn" href="{{ url_for('work.station_overview') }}">Back to Workstation Overview</a>
</p>
{% endblock %}
