{% extends "base.html" %}
{% block content %}
{% if not current_user.is_authenticated %}
<h2>Welcome to Hyperion Operations Hub</h2>
<p class="home-lede">
  Sign in with your assigned account to view production, orders, and inventory insights tailored to your role.
</p>
<p>
  If you do not yet have credentials, please contact a system administrator for access.
</p>
<a class="home-summary-link" href="{{ url_for('auth.login') }}">Log in to continue →</a>
{% else %}
{% set show_orders = order_summary is not none %}
{% set show_inventory = inventory_summary is not none %}

<h2>Hyperion Operations Overview</h2>
<p class="home-lede">Stay ahead of production promises and inventory risks with the highlights below.</p>

{% if show_orders or show_inventory %}
<div class="home-summary-grid">
  {% if show_orders %}
  <section class="home-summary-card">
    <div class="home-summary-heading">
      <h3>Orders</h3>
      <span class="home-summary-badge">Production</span>
    </div>
    <div class="home-summary-metrics">
      <p class="home-summary-metric"><strong>{{ order_summary.due_soon_count }}</strong> due within {{ order_summary.due_soon_window_days }} days</p>
      <p class="home-summary-metric"><strong>{{ order_summary.waiting_material_count }}</strong> waiting on material</p>
    </div>
    {% if order_summary.overdue_count %}
    <p class="home-summary-alert">⚠️ {{ order_summary.overdue_count }} orders are overdue</p>
    {% endif %}

    <h4 class="home-summary-subheading">Next due</h4>
    <ul class="home-summary-list">
      {% for order in order_summary.due_soon_preview %}
      <li>
        <div class="home-summary-line">
          <a href="{{ url_for('orders.view_order', order_id=order.id) }}" class="home-summary-primary">{{ order.order_number }}</a>
          <span class="home-summary-meta">Due {{ order.promised_date.strftime('%b %d, %Y') }}</span>
        </div>
        <div class="home-summary-line">
          <span class="home-summary-secondary">{{ order.customer_name or 'Internal' }}</span>
          <span class="home-summary-status">{{ order.status_label }}</span>
        </div>
      </li>
      {% else %}
      <li class="home-summary-empty">No orders are due in the next {{ order_summary.due_soon_window_days }} days.</li>
      {% endfor %}
    </ul>
    {% if order_summary.due_soon_count > order_summary.due_soon_preview|length %}
    <p class="home-summary-note">Showing the first {{ order_summary.preview_limit }} upcoming due dates.</p>
    {% endif %}

    {% if order_summary.overdue_preview %}
    <h4 class="home-summary-subheading">Overdue</h4>
    <ul class="home-summary-list">
      {% for order in order_summary.overdue_preview %}
      <li class="home-summary-critical">
        <div class="home-summary-line">
          <a href="{{ url_for('orders.view_order', order_id=order.id) }}" class="home-summary-primary">{{ order.order_number }}</a>
          <span class="home-summary-meta">Due {{ order.promised_date.strftime('%b %d, %Y') }}</span>
        </div>
        <div class="home-summary-line">
          <span class="home-summary-status">{{ order.status_label }}</span>
        </div>
      </li>
      {% endfor %}
    </ul>
    {% if order_summary.overdue_count > order_summary.overdue_preview|length %}
    <p class="home-summary-note">Showing the first {{ order_summary.preview_limit }} overdue orders.</p>
    {% endif %}
    {% endif %}

    <div class="home-summary-footer">
      <a class="home-summary-link" href="{{ url_for('orders.orders_home') }}">Go to Orders →</a>
    </div>
  </section>
  {% endif %}

  {% if show_inventory %}
  <section class="home-summary-card">
    <div class="home-summary-heading">
      <h3>Inventory</h3>
      <span class="home-summary-badge">Stock Control</span>
    </div>
    <div class="home-summary-metrics">
      <p class="home-summary-metric"><strong>{{ inventory_summary.out_count }}</strong> out of stock</p>
      <p class="home-summary-metric"><strong>{{ inventory_summary.low_count }}</strong> below minimum (stock remaining)</p>
    </div>

    <h4 class="home-summary-subheading">Items to review</h4>
    <ul class="home-summary-list">
      {% for entry in inventory_summary.preview %}
      <li {% if entry.is_out %}class="home-summary-critical"{% endif %}>
        <div class="home-summary-line">
          <span class="home-summary-primary">{{ entry.item.sku }}</span>
          {% if entry.is_out %}
          <span class="home-summary-meta">Out of stock &middot; Min {{ entry.min_stock }}</span>
          {% else %}
          <span class="home-summary-meta">{{ entry.on_hand }} on hand &middot; Min {{ entry.min_stock }}</span>
          {% endif %}
        </div>
        <div class="home-summary-line">
          <span class="home-summary-secondary">{{ entry.item.name or 'Unnamed item' }}</span>
        </div>
      </li>
      {% else %}
      <li class="home-summary-empty">All monitored items are above their minimum levels.</li>
      {% endfor %}
    </ul>
    {% if inventory_summary.total_alerts > inventory_summary.preview|length %}
    <p class="home-summary-note">Showing the {{ inventory_summary.preview_limit }} most urgent items.</p>
    {% endif %}

    <div class="home-summary-footer">
      <a class="home-summary-link" href="{{ url_for('inventory.inventory_home') }}">Go to Inventory →</a>
    </div>
  </section>
  {% endif %}
</div>
{% else %}
<p class="home-summary-empty">You are signed in, but your account does not have access to the shared order or inventory dashboards. Use the navigation menu to explore the areas available to you.</p>
{% endif %}
{% endif %}
{% endblock %}
