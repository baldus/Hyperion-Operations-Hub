{% extends "base.html" %}
{% block content %}
<h2>Snapshot Import Preview</h2>

<div class="dashboard-section">
  <div class="status-summary-grid">
    <div><strong>Total rows:</strong> {{ total_rows }}</div>
    <div><strong>Matched rows:</strong> {{ summary.matched_rows }}</div>
    <div><strong>Unmatched rows:</strong> {{ summary.unmatched_rows }}</div>
    <div><strong>Duplicates grouped:</strong> {{ summary.duplicate_groups }}</div>
    <div><strong>Collisions resolved:</strong> {{ summary.part_number_collisions_resolved }}</div>
  </div>
</div>

{% if unmatched_rows %}
<div class="dashboard-section">
  <h3>Unmatched Rows (first 50)</h3>
  <div class="table-container">
    <table class="inventory-table">
      <thead>
        <tr>
          {% for header in headers %}
          <th>{{ header }}</th>
          {% endfor %}
        </tr>
      </thead>
      <tbody>
        {% for row in unmatched_rows %}
        <tr>
          {% for header in headers %}
          <td>{{ row.get(header, '') }}</td>
          {% endfor %}
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
</div>
{% endif %}

<form method="post">
  <input type="hidden" name="step" value="commit">
  <input type="hidden" name="import_token" value="{{ import_token|e }}">
  <input type="hidden" name="part_number_column" value="{{ column_mapping.part_number }}">
  <input type="hidden" name="quantity_column" value="{{ column_mapping.quantity }}">
  <input type="hidden" name="description_column" value="{{ column_mapping.description }}">
  <input type="hidden" name="uom_column" value="{{ column_mapping.uom }}">
  <input type="hidden" name="notes_column" value="{{ column_mapping.notes }}">
  <input type="hidden" name="duplicate_strategy" value="{{ duplicate_strategy }}">
  <input type="hidden" name="name" value="{{ snapshot_meta.name or '' }}">
  <input type="hidden" name="snapshot_date" value="{{ snapshot_meta.snapshot_date.strftime('%Y-%m-%d') if snapshot_meta.snapshot_date }}">
  <input type="hidden" name="source" value="{{ snapshot_meta.source or '' }}">

  <button type="submit" class="action-btn">Proceed & Create Snapshot</button>
  <a href="{{ url_for('physical_inventory.create_snapshot', step='map', import_token=import_token) }}" class="link-btn">Back to Mapping</a>
</form>
{% endblock %}
