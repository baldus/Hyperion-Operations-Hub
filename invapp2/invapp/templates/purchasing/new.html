{% extends "base.html" %}

{% block content %}
<h2>Log Purchase Need</h2>
<p class="section-lead">Capture the details of the item or material that needs to be purchased so the purchasing team can follow up.</p>

<form method="post" class="form-grid purchasing-form" data-item-search-form>
    <input type="hidden" id="item_id" name="item_id" value="{{ form_data.item_id }}">
    <input type="hidden" id="item_number" name="item_number" value="{{ form_data.item_number }}">

    <div class="form-row item-search-row">
        <label for="item-search">Search Item / Part #</label>
        <div class="item-search">
            <input
                type="text"
                id="item-search"
                name="item_search"
                value="{{ form_data.item_number }}"
                placeholder="Start typing an item number or description"
                autocomplete="off"
                data-search-url="{{ url_for('item_search.search_items') }}"
                aria-expanded="false"
                aria-controls="item-search-results"
            >
            <div class="item-search-results" id="item-search-results" role="listbox" aria-label="Item search results"></div>
            <div class="item-search-status" id="item-search-status" role="status" aria-live="polite"></div>
        </div>
        <div class="item-search-summary" id="item-search-summary" aria-live="polite">
            <div class="item-search-summary-title">Current on-hand</div>
            <div class="item-search-summary-total" id="item-search-total">â€”</div>
            <ul class="item-search-summary-locations" id="item-search-locations"></ul>
        </div>
    </div>

    <div class="form-row two-col">
        <div>
            <label for="item_name">Item name</label>
            <input type="text" id="item_name" name="item_name" value="{{ form_data.item_name }}" placeholder="Auto-filled from item search">
        </div>
        <div>
            <label for="item_description">Item description</label>
            <input type="text" id="item_description" name="item_description" value="{{ form_data.item_description }}" placeholder="Auto-filled from item search">
        </div>
    </div>

    <div class="form-row">
        <label for="title">Item or part <span aria-hidden="true">*</span></label>
        <input type="text" id="title" name="title" value="{{ form_data.title }}" required>
    </div>

    <div class="form-row">
        <label for="description">Reason or description</label>
        <textarea id="description" name="description" rows="3">{{ form_data.description }}</textarea>
    </div>

    <div class="form-row two-col">
        <div>
            <label for="quantity">Quantity needed</label>
            <input type="text" id="quantity" name="quantity" value="{{ form_data.quantity }}" placeholder="e.g. 25">
        </div>
        <div>
            <label for="unit">Unit</label>
            <input type="text" id="unit" name="unit" value="{{ form_data.unit }}" placeholder="ea, box, roll">
        </div>
    </div>

    <div class="form-row two-col">
        <div>
            <label for="needed_by">Needed by</label>
            <input type="date" id="needed_by" name="needed_by" value="{{ form_data.needed_by }}">
        </div>
        <div>
            <label for="requested_by">Requested by <span aria-hidden="true">*</span></label>
            <input type="text" id="requested_by" name="requested_by" value="{{ form_data.requested_by }}" required>
        </div>
    </div>

    <div class="form-row two-col">
        <div>
            <label for="supplier_name">Preferred supplier</label>
            <input type="text" id="supplier_name" name="supplier_name" value="{{ form_data.supplier_name }}">
        </div>
        <div>
            <label for="supplier_contact">Supplier contact</label>
            <input type="text" id="supplier_contact" name="supplier_contact" value="{{ form_data.supplier_contact }}" placeholder="email or phone">
        </div>
    </div>

    <div class="form-row">
        <label for="notes">Additional notes for purchasing</label>
        <textarea id="notes" name="notes" rows="3">{{ form_data.notes }}</textarea>
    </div>

    <div class="form-actions">
        <a class="action-btn subtle-action" href="{{ url_for('purchasing.purchasing_home') }}">Cancel</a>
        <button type="submit" class="action-btn primary-action">Submit Request</button>
    </div>
</form>
{% endblock %}

{% block extra_scripts %}
<script defer src="{{ url_for('static', filename='js/purchasing-item-search.js') }}"></script>
{% endblock %}
