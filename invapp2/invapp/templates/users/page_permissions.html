{% extends "base.html" %}
{% block content %}
<h2>Page Permissions</h2>
<p>Assign which roles can open each protected area of the application. Leave a page without any roles to fall back to its default access rules.</p>
{% if error_message %}
  <p class="flash danger">{{ error_message }}</p>
{% endif %}
<form method="post">
  <table class="permission-table">
    <thead>
      <tr>
        <th scope="col">Page</th>
        <th scope="col">Allowed Roles</th>
        <th scope="col">Default</th>
      </tr>
    </thead>
    <tbody>
    {% for page in pages %}
      <tr>
        <th scope="row">{{ page.label }}</th>
        <td class="permission-roles">
          {% for role in roles %}
          <label class="permission-role">
            <input type="checkbox" name="page_roles-{{ page.page_name }}" value="{{ role.id }}" {% if role.id in page.selected_role_ids %}checked{% endif %}>
            {{ role.name }}
          </label>
          {% endfor %}
        </td>
        <td class="permission-default">
          {% if page.default_roles %}
            {{ page.default_roles | join(', ') }}
          {% else %}
            admin
          {% endif %}
        </td>
      </tr>
    {% endfor %}
    </tbody>
  </table>
  <div class="form-actions">
    <button type="submit" class="nav-btn">Save Changes</button>
  </div>
</form>
{% endblock %}
